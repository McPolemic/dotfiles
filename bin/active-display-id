#!/usr/bin/env swift
import CoreGraphics

guard let event = CGEvent(source: nil) else {
    // fallback to main display
    print(1)
    exit(0)
}

let location = event.location

var displayCount: UInt32 = 0
CGGetActiveDisplayList(0, nil, &displayCount)
var displays = [CGDirectDisplayID](repeating: 0, count: Int(displayCount))
CGGetActiveDisplayList(displayCount, &displays, &displayCount)

// default to main display
var chosenIndex = 1

for (idx, display) in displays.enumerated() {
    let bounds = CGDisplayBounds(display)
    if bounds.contains(location) {
        chosenIndex = idx + 1    // screencapture -D is 1-based
        break
    }
}

print(chosenIndex)
